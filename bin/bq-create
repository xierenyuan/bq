#!/usr/bin/env node

const logger = require('../lib/logger')
const chalk = require('chalk')
const inquirer = require('inquirer')
const path = require('path')
const fs = require('fs')
const exists = fs.existsSync

/**
 * Padding.
 */
console.log()
process.on('exit', function () {
  console.log()
})

inquirer.prompt([{
  type: 'list',
  name: 'template',
  message: 'è¯·é€‰æ‹©åˆ›å»ºçš„æ¨¡æ¿æ–‡ä»¶',
  choices: [{name: 'vue', checked: true}, {name: 'service'}]
},{
  type: 'input',
  name: 'file',
  message: 'ğŸ˜†  è¯·è¾“å…¥ä¸€ä¸ªæ–‡ä»¶åç§°ï¼Œä¸è¦åç¼€ä¸è¦åç¼€'
}]).then(function(answers) {
    run(answers)
})

/**
 * ç”Ÿæˆ
 */
function run(template) {
  let tpl = getTemplate(template)
  if (exists(tpl.file)) {
    inquirer.prompt([{
      type: 'confirm',
      message: 'è¿™ä¸ªæ–‡ä»¶ä»¥åŠå­˜åœ¨æ˜¯å¦ è¦†ç›–åœ¨ç»§ç»­ï¼Ÿ',
      name: 'ok'
    }]).then(function (answers) {
      if (answers.ok) {
        generate(tpl, template.file)
      }
    })
  } else {
    generate(tpl, template.file)
  }
}

function generate(input, name) {
  let content = fs.readFileSync(input.tpl)
  fs.writeFile(input.file, content.toString(), function(err) {
    if(err) logger.fatal(err)
    console.log(chalk.blue(`${name} åˆ›å»ºæˆåŠŸ!`))
  })
}

function getTemplate(answers) {
  try {
    switch (true) {
      case answers.template === 'vue':
        return {tpl: path.resolve(__dirname, '../lib/.bq.vue'), file: path.resolve(process.cwd(), `${answers.file}.vue`)}
      case answers.template === 'service':
        return {tpl: path.resolve(__dirname, '../lib/.bq.service.js'), file: path.resolve(process.cwd(), `${answers.file}.js`)}
      default:
        return {};
    }
  } catch (error) {
    console.error(error)
  }

}
